@model Magazin.Models.DialogViewModel
@using Data.Entities
@using Kendo.Mvc.UI
@{
    string wrapId = "tree_" + Guid.NewGuid().ToString("N");
    string toolbarName = "tlbr_" + Guid.NewGuid().ToString("N");
}



@(Html.Kendo().ToolBar()
        .Name(toolbarName)
        .Items(toolbar =>
        {
            toolbar.Add().Type(CommandType.ButtonGroup).Buttons(btns =>
            {
                btns.Add().Text("Добавить корневой").ShowText(ShowIn.Overflow).SpriteCssClass("mdi mdi-folder-plus").HtmlAttributes(new { title = "Создать", data_action = "Add" });
                btns.Add().Text("Добавить").ShowText(ShowIn.Overflow).SpriteCssClass("mdi mdi-plus").HtmlAttributes(new { title = "Создать", data_action = "Add" });
                btns.Add().Text("Редактировать").ShowText(ShowIn.Overflow).SpriteCssClass("mdi mdi-pencil").HtmlAttributes(new { title = "Редактировать", data_action = "Edit" });
                btns.Add().Text("Удалить").ShowText(ShowIn.Overflow).SpriteCssClass("mdi mdi-close").HtmlAttributes(new { title = "Удалить", data_action = "Delete" });
            });
        }
      )
)

@(Html.Kendo().TreeList<ProductCategory>()
        .Name(wrapId)
        .Selectable(true)
        .Filterable()
        .Sortable()
        .Editable(false)        
        .Events(e =>
        {
            e.Change(wrapId + ".onChange");
        })        
        .Columns(columns =>
        {
            columns.Add().Title("Наименование").Field(x => x.Title);
        })        
        .DataSource(ds => ds
            .Model(x =>
            {
                x.Id(p => p.Id);
                x.ParentId(p => p.ParentId);
            })
            .PageSize(15)
            .Read(read => read                
                .Action("GetCategories", "Product", new { Area = "Admin" })))
)

<script>
    var dialogControl = window['@Model.DialogId'];
    window['@wrapId'] = new SimpleControl('@wrapId', 'categories');

    (function () {
        var tree = window['@wrapId'];

        dialogControl.addControl(tree);

        tree.onChange = function () {            
            var treeview = $("#@wrapId").data("kendoTreeList");
            var $data = treeview.select();
            var dataItem = this.dataItem($data);

            var args = {
                sender: tree,
                event: "change",
                data: dataItem
            }

            dialogControl.controlFire(args);
        };
    })();

    $(function () {
        var $toolbar = $('#@toolbarName');
        $toolbar.find(".k-sprite").removeClass("k-sprite");
    });
</script>